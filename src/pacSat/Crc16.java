package pacSat;

import ax25.KissFrame;
import fileStore.PacSatField;


public class Crc16 { 

    static short crc = 0;
    
    public static boolean goodCrc(int[] bytes) {
    	crc = 0;
    	for (int j=0; j < bytes.length-2; j++)
    		gen_crc(bytes[j] & 0xFF);
    	//System.out.println(Integer.toHexString(crc));
    	gen_crc(bytes[bytes.length-2] & 0xFF);  // CRC with first CRC byte
    	if (gen_crc(bytes[bytes.length-1] & 0xFF) != 0) {  // CRC with 2nd byte
    		//System.out.println("bad");// bad
    		return false;
    	} else {
    		//System.out.println("good");//good
    		return true;
    	}
    }
    
    private static short gen_crc(int data) {
    	crc ^= data << 8;
    	for(int y=0; y < 8; y++)
    		if ((crc & 0x8000) != 0)
    			crc = (short) (crc << 1 ^ 0x1021);
    		else
    			crc <<= 1;
    	return crc;
    }
        
    public static void main(String[] args) {
    	
    	// header checksum is field 0A and is 0x3E,0x09
     	int[] by = {0x3E,0x09};
     	int headerChecksum = KissFrame.getIntFromBytes(by);
     	System.out.println("Orig CRC:" + headerChecksum);
     	
 int[] bytes = {0xAA,0x55,0x01,0x00,0x04,0x1C,0x0B,0x00,0x00,0x02,0x00,0x08,0x77,0x65,0x30,0x37,0x32,0x30,0x30,0x36,0x03,
		 0x00,0x03,0x20,0x20,0x20,0x04,0x00,0x04,0x3F,0x13,0x00,0x00,0x05,0x00,0x04,0xA0,0xFB,0x51,0x5B,0x06,0x00,0x04,0x4D,
		 0x1C,0x52,0x5B,0x12,0x00,0x04,0x4D,0x1C,0x52,0x5B,0x07,0x00,0x01,0x00,0x08,0x00,0x01,0x03,0x09,0x00,0x02,0x0D,0x0D,
		 0x0A,0x00,0x02,0x00,0x00,0x0B,0x00,0x02,0x50,0x00,0x00,0x00,0x00};

 byte[] bytes3 = {(byte) 0xAA,0x55,0x01,0x00,0x04,0x1C,0x0B,0x00,0x00,0x02,0x00,0x08,0x77,0x65,0x30,0x37,0x32,0x30,0x30,0x36,0x03,
		 0x00,0x03,0x20,0x20,0x20,0x04,0x00,0x04,0x3F,0x13,0x00,0x00,0x05,0x00,0x04,(byte) 0xA0,(byte) 0xFB,0x51,0x5B,0x06,0x00,0x04,0x4D,
		 0x1C,0x52,0x5B,0x12,0x00,0x04,0x4D,0x1C,0x52,0x5B,0x07,0x00,0x01,0x00,0x08,0x00,0x01,0x03,0x09,0x00,0x02,0x0D,0x0D,
		 0x0A,0x00,0x02,0x00,0x00,0x0B,0x00,0x02,0x50,0x00,0x00,0x00,0x00};

 	// body checksum for this is 0e 16
 String s1 = "To  : ALL\r\n" + 
 		"From: PY4ZBZ\r\n" + 
 		"Time: 170642UTC\r\n" + 
 		"Date: 28 Mar 2018\r\n" + 
 		"-----------------\r\n" + 
 		"73 from PY4ZBZ";
 
   
 String s = "HELLO";
 
 	byte[] bytes4 = s.getBytes();
 	
 	
 	//Crc16 crc = new Crc16(bytes);
 	short cs = 0;
 	for(int b : bytes)
 		cs += b & 0xff;
 	System.out.println(cs);
 	
 	PacSatField pf = new PacSatField(cs, 0x09);
 	System.out.println(pf);
    }

}